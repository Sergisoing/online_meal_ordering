<ul class="breadcrumb">
    <li><span class="primary-font"><i class="icon-home"></i></span><a href="index.html"></a>商家店铺管理</li>
    <li>店铺管理</li>
</ul>

<div class="smart-widget widget-dark-blue">
    <div class="smart-widget-header">
        添加店铺
        <span class="smart-widget-option">
            <span class="refresh-icon-animated">
                <i class="fa fa-circle-o-notch fa-spin"></i>
            </span>
            <a href="#" class="widget-toggle-hidden-option">
                <i class="fa fa-cog"></i>
            </a>
            <a href="#" class="widget-collapse-option" data-toggle="collapse">
                <i class="fa fa-chevron-up"></i>
            </a>
            <a href="#" class="widget-refresh-option">
                <i class="fa fa-refresh"></i>
            </a>
            <a href="#" class="widget-remove-option">
                <i class="fa fa-times"></i>
            </a>
        </span>
    </div>
    <div class="smart-widget-inner">
        <div class="smart-widget-hidden-section">
            <ul class="widget-color-list clearfix">
                <li style="background-color:#20232b;" data-color="widget-dark"></li>
                <li style="background-color:#4c5f70;" data-color="widget-dark-blue"></li>
                <li style="background-color:#23b7e5;" data-color="widget-blue"></li>
                <li style="background-color:#2baab1;" data-color="widget-green"></li>
                <li style="background-color:#edbc6c;" data-color="widget-yellow"></li>
                <li style="background-color:#fbc852;" data-color="widget-orange"></li>
                <li style="background-color:#e36159;" data-color="widget-red"></li>
                <li style="background-color:#7266ba;" data-color="widget-purple"></li>
                <li style="background-color:#f5f5f5;" data-color="widget-light-grey"></li>
                <li style="background-color:#fff;" data-color="reset"></li>
            </ul>
        </div>
        <div class="smart-widget-body">
            <form id="add-form" class="form-horizontal no-margin" id="basic-constraint" data-validate="parsley" novalidate="" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="inputEmail1" class="col-lg-2 control-label">店铺名称</label>
                    <div class="col-lg-10">
                        <input type="text" name="name" class="form-control" placeholder="请输入店铺名称">
                    </div><!-- /.col -->
                </div>
                <div class="form-group">
                    <label for="inputEmail1" class="col-lg-2 control-label">店铺电话</label>
                    <div class="col-lg-10">
                        <input type="tel" name="phone" class="form-control" maxlength="11" placeholder="请输入店铺电话">
                    </div><!-- /.col -->
                </div>
                <div class="form-group">
                    <label for="inputEmail1" class="col-lg-2 control-label">店铺地址</label>
                    <div class="col-lg-10">
                        <input type="text" name="address" class="form-control" placeholder="请输入店铺地址">
                    </div><!-- /.col -->
                </div>
                <div class="form-group">
                    <label for="inputEmail1" class="col-lg-2 control-label">店铺缩略图</label>
                    <div class="col-lg-10">
                        <input type="file" class="form-control" name="picture">
                    </div><!-- /.col -->
                </div>

                <div class="form-group">
                    <label for="inputEmail1" class="col-lg-2 control-label">店铺详细描述</label>
                    <div class="col-lg-10">
                        <input type="text" name="desc" class="form-control" placeholder="请填写店铺详细描述">
                    </div><!-- /.col -->
                </div>
                <div class="form-group">
                    <label for="inputEmail1" class="col-lg-2 control-label">店铺详细展示图</label>
                    <div class="col-lg-10 ">
                        <input type="file" class="form-control" name="detail_pics1">
                    </div>
                    <div class="col-lg-10 col-lg-offset-2">
                        <input type="file" class="form-control" name="detail_pics2">
                    </div>
                    <div class="col-lg-10 col-lg-offset-2">
                        <input type="file" class="form-control" name="detail_pics3">
                    </div>
                    <div class="col-lg-10 col-lg-offset-2">
                        <input type="file" class="form-control" name="detail_pics4">
                    </div>
                </div>
                <div class="text-right m-top-md">
                    <button type="button" class="btn btn-info" id="add">添加</button>
                </div>
            </form>
        </div>
    </div><!-- ./smart-widget-inner -->
</div>

<div class="smart-widget widget-dark-blue">
    <div class="smart-widget-header">
        店铺列表
        <span class="smart-widget-option">
            <span class="refresh-icon-animated">
                <i class="fa fa-circle-o-notch fa-spin"></i>
            </span>
            <a href="#" class="widget-toggle-hidden-option">
                <i class="fa fa-cog"></i>
            </a>
            <a href="#" class="widget-collapse-option" data-toggle="collapse">
                <i class="fa fa-chevron-up"></i>
            </a>
            <a href="#" class="widget-refresh-option">
                <i class="fa fa-refresh"></i>
            </a>
            <a href="#" class="widget-remove-option">
                <i class="fa fa-times"></i>
            </a>
        </span>
    </div>
    <div class="smart-widget-inner">
        <div class="smart-widget-hidden-section">
            <ul class="widget-color-list clearfix">
                <li style="background-color:#20232b;" data-color="widget-dark"></li>
                <li style="background-color:#4c5f70;" data-color="widget-dark-blue"></li>
                <li style="background-color:#23b7e5;" data-color="widget-blue"></li>
                <li style="background-color:#2baab1;" data-color="widget-green"></li>
                <li style="background-color:#edbc6c;" data-color="widget-yellow"></li>
                <li style="background-color:#fbc852;" data-color="widget-orange"></li>
                <li style="background-color:#e36159;" data-color="widget-red"></li>
                <li style="background-color:#7266ba;" data-color="widget-purple"></li>
                <li style="background-color:#f5f5f5;" data-color="widget-light-grey"></li>
                <li style="background-color:#fff;" data-color="reset"></li>
            </ul>
        </div>
        <div class="smart-widget-body">
            <assign name="tableindex" value="1" />
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>店铺名称</th>
                        <th>店铺电话</th>
                        <th>店铺地址</th>
                        <th>店铺缩略图</th>
                        <th>店铺详细描述</th>
                        <th>当前状态</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody>
                    <foreach name="storeList" item="v">
                    <tr>
                        <td>{$tableindex++}</td>
                        <td>{$v['name']}</td>
                        <td>{$v['phone']}</td>
                        <td>{$v['adress']}</td>
                        <td>{$v['picture']}</td>
                        <td>{$v['desc']}</td>
                        <td>
                            <if condition="$v.is_delete eq 1">
                                <span class="label label-danger">停用</span>
                            <else />
                                <span class="label label-info">正常</span>
                            </if>
                        </td>
                        <td style="width: 100px;">
                            <div class="btn-group">
                                <a href="#resetPwModel" data-toggle="modal" class="edit btn btn-primary btn-xs" data-id="{$v['id']}">编辑</a>
                                <if condition="$v.is_delete eq 1">
                                    <a href="javascript:void(0)" class="delete btn btn-info btn-xs" data-id="{$v['id']}" >恢复</a>
                                <else />
                                    <a href="javascript:void(0)" class="delete btn btn-danger btn-xs" data-id="{$v['id']}" >停用</a>
                                </if>

                            </div>
                        </td>
                    </tr>
                    </foreach>
                </tbody>
            </table>
        </div>
    </div><!-- ./smart-widget-inner -->
</div>


<div class="modal fade" id="resetPwModel">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="myModalLabel">重置密码</h4>
            </div>
            <div class="modal-body">
                <form id="update-form" class="form-horizontal no-margin" id="basic-constraint" data-validate="parsley" novalidate="" enctype="multipart/form-data">
                    <div class="form-group">
                        <label for="inputEmail1" class="col-lg-3 control-label">店铺名称</label>
                        <div class="col-lg-9">
                            <input type="text" name="name" class="form-control" placeholder="请输入店铺名称">
                        </div><!-- /.col -->
                    </div>
                    <div class="form-group">
                        <label for="inputEmail1" class="col-lg-3 control-label">店铺电话</label>
                        <div class="col-lg-9">
                            <input type="tel" name="phone" class="form-control" maxlength="11" placeholder="请输入店铺电话">
                        </div><!-- /.col -->
                    </div>
                    <div class="form-group">
                        <label for="inputEmail1" class="col-lg-3 control-label">店铺地址</label>
                        <div class="col-lg-9">
                            <input type="text" name="address" class="form-control" placeholder="请输入店铺地址">
                        </div><!-- /.col -->
                    </div>
                    <div class="form-group">
                        <label for="inputEmail1" class="col-lg-3 control-label">店铺缩略图</label>
                        <div class="col-lg-9">
                            <input type="file" class="form-control" name="picture">
                        </div><!-- /.col -->
                    </div>

                    <div class="form-group">
                        <label for="inputEmail1" class="col-lg-3 control-label">店铺详细描述</label>
                        <div class="col-lg-9">
                            <input type="text" name="desc" class="form-control" placeholder="请填写店铺详细描述">
                        </div><!-- /.col -->
                    </div>
                    <div class="form-group">
                        <label for="inputEmail1" class="col-lg-3 control-label">店铺详细展示图</label>
                        <div class="col-lg-9 ">
                            <input type="file" class="form-control" name="detail_pics1">
                        </div>
                        <div class="col-lg-9 col-lg-offset-3">
                            <input type="file" class="form-control" name="detail_pics2">
                        </div>
                        <div class="col-lg-9 col-lg-offset-3">
                            <input type="file" class="form-control" name="detail_pics3">
                        </div>
                        <div class="col-lg-9 col-lg-offset-3">
                            <input type="file" class="form-control" name="detail_pics4">
                        </div>
                    </div>
                    <p class="text-danger err-msg">图片修改为覆盖上之前的图片</p>
                    <input type="hidden" name="id">
                    <div class="text-right m-top-md">
                        <button type="button" data-dismiss="modal" aria-hidden="true" class="btn btn-info" id="update">更新</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>


<script type="text/javascript">
$(function() {
    $('.delete').on('click', function () {
        var id = $(this).data('id');
        var url = '';
        if ($(this).text() == '恢复') {
            url = '__APP__/admin/store/reupStore';
        } else {
            url = '__APP__/admin/store/deleteStore';
        }
        $.post(url, {id: id}, function (res) {
            if ('ok' == res.status) {
                Common.successAlert('更新成功');
                setTimeout(function () {
                    location.reload();
                }, 1000);
            } else {
                Common.warningAlert(res.data);
            }
        }, 'json')
        .error(function () {
            Common.warningAlert('网络错误，请稍后再试！');
        });
    });

    $('.edit').on('click', function () {
        var tds = $(this).parents('tr').children('td');
        update.name = tds.eq(1).text();
        update.phone = tds.eq(2).text();
        update.address = tds.eq(3).text();
        update.desc = tds.eq(6).text();
        update.id = $(this).data('id');
    });


    var add = {
        get form() {
            return new FormData($('#add-form')[0]);
        },
        bindEvent: function () {
            $('#add').on('click', function () {
                $.ajax({
                    url: '__APP__/admin/store/storeAdd',
                    type: 'POST',
                    dataType: 'json',
                    data: add.form,
                    processData: false,
                    contentType: false,
                    cache: false
                })
                .done(function(res) {
                    if (res.status == 'error') {
                        alert(res.data);
                    } else {
                        Common.successAlert('添加成功', function () {
                            location.reload();
                        });
                    }
                })
                .error(function () {
                    Common.successAlert('网络错误，请稍后再试');
                });
                return false;
            });
        },
        init: function() {
            this.bindEvent();
        }
    };
    add.init();

    var update = {
        set name(value) {
            $('input[name=name]').val(value);
        },
        set phone(value) {
            $('input[name=phone]').val(value);
        },
        set address(value) {
            $('input[name=address]').val(value);
        },
        set desc(value) {
            $('input[name=desc]').val(value);
        },
        set id(value) {
            $('input[name=id]').val(value);
        },
        get form() {
            return new FormData($('#update-form')[0]);
        },
        bindEvent: function () {
            $('#update').on('click', function () {
                $.ajax({
                    url: '__APP__/admin/store/storeUpdate',
                    type: 'POST',
                    dataType: 'json',
                    data: update.form,
                    processData: false,
                    contentType: false,
                    cache: false
                })
                .done(function(res) {
                    if (res.status == 'error') {
                        alert(res.data);
                        return false;
                    } else {
                        Common.successAlert('更新成功', function () {
                            location.reload();
                        });
                    }
                })
                .error(function () {
                    Common.successAlert('网络错误，请稍后再试');
                });
                return false;
            });
        },
        init: function () {
            this.bindEvent();
        }
    };
    update.init();
});

</script>
